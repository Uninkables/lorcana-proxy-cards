<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Lorcana Proxy Card Generator</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <h1>Lorcana Proxy Card Generator</h1>
  
<h2>Search Cards to Add</h2>

<label class="switch">
  <input type="checkbox" id="hideHighRarity" />
  <span class="slider"></span>
</label>
  
<input
  id="cardSearch"
  type="text"
  placeholder="Search for a card..."
  autocomplete="off"
/>

<div id="searchResults"></div>

<h2>Selected Cards</h2>
<div id="selectedCards"></div>

<script>
let cards = [];
const selected = new Map();

fetch("cards.json")
  .then(r => r.json())
  .then(data => {
    cards = data;
  });

const searchInput = document.getElementById("cardSearch");
const resultsDiv = document.getElementById("searchResults");
const selectedDiv = document.getElementById("selectedCards");
const hideHighRarityCheckbox = document.getElementById("hideHighRarity");

searchInput.addEventListener("input", () => {
  const query = searchInput.value.toLowerCase();
  resultsDiv.innerHTML = "";

hideHighRarityCheckbox.addEventListener("change", () => {
  searchInput.dispatchEvent(new Event("input"));
});
  
  if (!query) return;

  cards
    .filter(c => {
      const matchesSearch =
        `${c.name} - ${c.version}`.toLowerCase().includes(query);
  
      const hideHighRarity = hideHighRarityCheckbox.checked;
  
      const isFilteredRarity =
        c.rarity === "Epic" || c.rarity === "Enchanted";
  
      if (hideHighRarity && isFilteredRarity) return false;
  
      return matchesSearch;
    })
    .slice(0, 20)
    .forEach(card => {
      const div = document.createElement("div");
      div.className = "search-result";
    
      const img = document.createElement("img");
      img.src = card.image_uris.digital.small;
      img.alt = `${card.name} - ${card.version}`;
      img.className = "search-thumb";
    
      const info = document.createElement("div");
      info.className = "card-info";
    
      const title = document.createElement("div");
      title.className = "card-title";
      title.textContent = `${card.name} - ${card.version}`;
    
      const sub = document.createElement("div");
      sub.className = "card-sub";
      sub.textContent = `${card.collector_number}/204 EN·${card.set.code}`;
    
      info.append(title, sub);
      const thumbWrapper = document.createElement("div");
      thumbWrapper.className = "thumb-wrapper";
      thumbWrapper.appendChild(img);
      
      div.append(thumbWrapper, info);
    
      div.onclick = () => addCard(card);
    
      resultsDiv.appendChild(div);
    });
});

function addCard(card) {
  const key = `${card.name} - ${card.version} (${card.collector_number}/204 EN·${card.set.code})`;

  if (selected.has(key)) {
    selected.set(key, selected.get(key) + 1);
  } else {
    selected.set(key, 1);
  }

  renderSelected();
  resultsDiv.innerHTML = "";
  searchInput.value = "";
}

function renderSelected() {
  selectedDiv.innerHTML = "";

  for (const [key, qty] of selected.entries()) {
    const row = document.createElement("div");
    row.className = "selected-card";

    const name = document.createElement("span");
    name.textContent = key;

    const minus = document.createElement("button");
    minus.textContent = "−";
    minus.className = "circle-btn";
    minus.onclick = () => updateQty(key, qty - 1);

    const input = document.createElement("input");
    input.type = "number";
    input.min = "0";
    input.value = qty;
    input.className = "qty-input";
    input.onchange = () =>
      updateQty(key, parseInt(input.value || 0, 10));

    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.className = "circle-btn";
    plus.onclick = () => updateQty(key, qty + 1);

    row.append(name, minus, input, plus);
    selectedDiv.appendChild(row);
  }
}

function updateQty(key, qty) {
  if (qty <= 0) {
    selected.delete(key);
  } else {
    selected.set(key, qty);
  }
  renderSelected();
}
</script>
  
<!--
  <p>Loaded contents of <code>cards.json</code>:</p>

  <pre id="output">Loading...</pre>

  <script>
    fetch("cards.json")
      .then(res => {
        if (!res.ok) throw new Error("cards.json not found");
        return res.json();
      })
      .then(cards => {
        document.getElementById("output").textContent =
          JSON.stringify(cards, null, 2);
      })
      .catch(err => {
        document.getElementById("output").textContent =
          "Error: " + err.message;
      });
  </script>
-->

  
</body>
</html>



